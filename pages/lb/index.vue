<template>
    <section id="section-1" class="flex flex-col justify-center items-center h-screen bg-[url('public/images/banner-lb.webp')] bg-no-repeat bg-cover bg-center">
        <div class="container">
            <div class="flex flex-col justify-center gap-4 w-full md:w-1/2 xl:w-1/3 h-full">
                <h1 class="text-white text-2xl lg:text-[3rem] font-lora !leading-[1.3]" data-aos="fade-up" data-aos-delay="100"><span class="block text-white font-medium">Empowering Every Lebanese</span>with Inclusive Access to Essential Financial Services</h1>
                <div data-aos="fade-up" data-aos-delay="200">
                    <ScrollButton target="contact-us" class="mt-3 md:mt-6 py-2 px-8 text-sm font-medium text-black bg-[#C7D165] hover:bg-white rounded-full transition-[background] duration-300 ease-in-out" >Contact us</ScrollButton>
                </div>
            </div>
        </div>
    </section>

    <section id="section-2" class="about-us py-16 md:py-32 mx-auto">
        <div class="container">
            <div class="flex gap-1 text-sm text-[#C7D165] font-libre font-bold uppercase" data-aos="fade-up">
                <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#C7D165"/>
                </svg>
                <h2>About Monty Finance</h2>
            </div>
            <div class="flex max-lg:flex-col gap-12 lg:gap-24 xl:gap-48">
                <div class="flex-1 flex flex-col">
                    <h3 class="mt-6 text-2xl lg:text-5xl font-lora font-bold" data-aos="fade-up">Unlocking your financial freedom with confidence</h3>
                    <div class="flex flex-col gap-2">
                        <p class="mt-6 text-xl text-[#09052B] font-lora font-bold" data-aos="fade-up">Welcome to Monty Finance SAL, where innovation meets integrity, and financial inclusion is our driving force.</p>
                        <p class="mt-2 text-base text-[#73788B]" data-aos="fade-up">Monty Finance SAL is a FinTech company committed to driving financial inclusion by fostering trust, empowering its clients, and meeting their financial service needs seamlessly. It is a licensed financial institution, holding an e-wallet and international money remittance license. Through MyMonty, Monty Finance's innovative mobile application, users can effortlessly open eWallet accounts, manage their finances, and perform transactions and payments, all tailored to meet their needs with lower fees, all from the comfort of their homes.</p>
                    </div>
                </div>
                <div class="flex-1">
                    <img class="" src="/images/welcome-to-montyfinance.webp" alt="Welcome to Monty Finance" width="992" height="642" />
                </div> 
            </div>

            <div class="flex max-lg:flex-col gap-12 lg:gap-24 xl:gap-48 mt-12 lg:mt-24">
                <div class="flex-1 order-1 lg:order-0">
                    <img class="" src="/images/bold-vision.webp" alt="Bold Vision" width="992" height="788" />
                </div>
                <div class="flex-1 order-0 lg:order-1">
                    <p class="mt-6 text-xl text-[#09052B] font-lora font-bold" data-aos="fade-up">At Monty Finance SAL, we firmly believe that access to financial services is a fundamental right.</p>
                    <p class="mt-2 text-base text-[#73788B]" data-aos="fade-up">Leveraging our team's local and international experience and  expertise, built over decades in leading financial and consulting firms, we are dedicated to developing tailored financial solutions that address the unique needs and challenges of the Lebanese community.</p>
                    <p class="mt-6 text-xl text-[#09052B] font-lora font-bold" data-aos="fade-up">In light of the financial challenges Lebanon was facing, we at Monty Finance SAL are committed to a bold vision:</p>
                    <p class="mt-2 text-base text-[#73788B]" data-aos="fade-up">Ensuring that the Lebanese people, diaspora, and residents have unfettered access to essential financial services.</p>
                    <p class="mt-2 text-base text-[#73788B]" data-aos="fade-up">Guided  by the visionary leadership of Mr. Mountasser El Hachem, Chairman of Monty Group, we have taken decisive steps to achieve this vision. With its innovative products, services, and ease of access, Monty Finance is poised to make a significant impact on Lebanon's financial landscape.</p>
                </div> 
            </div>

            <div class="flex max-lg:flex-col gap-12 lg:gap-24 xl:gap-48 mt-12 lg:mt-24">
                <div class="flex-1 flex flex-col">
                    <div class="flex flex-col gap-2">
                        <p class="mt-6 text-xl text-[#09052B] font-lora font-bold" data-aos="fade-up">Committed to Sustainability with the UN Global Compact</p>
                        <p class="mt-2 text-base text-[#73788B]" data-aos="fade-up">Monty Finance SAL is a proud participant in the United Nations Global Compact, the world’s largest corporate sustainability initiative. By aligning with its Ten Universal Principles in human rights, labor, environment, and anti-corruption, we are dedicated to conducting business ethically and responsibly. As part of a global network of 20,000+ companies, we actively support the Sustainable Development Goals (SDGs) and continuously work towards creating a positive and lasting impact.</p>
                    </div>
                </div>
                <div class="flex-1">
                    <img class="" src="/images/united-nations.webp" alt="United Nations" width="992" height="642" />
                </div> 
            </div>
        </div>
    </section>

    <section id="section-4" class="text-white">
        <div class="container">
            <div class="px-8 md:px-16 py-16 md:py-32 bg-[url('public/images/mission-vision-lb.webp')] bg-no-repeat bg-cover bg-top flex max-md:flex-col justify-center items-stretch gap-14 md:gap-28 rounded-xl">
                <div class="backgroundBlur flex-1 p-6 rounded-xl">
                    <div class="flex items-start gap-4" data-aos="fade-up">
                        <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#FFFFFF"/>
                        </svg>
                        <h2 class="mt-2 text-2xl lg:text-4xl font-lora font-bold">Mission</h2>
                    </div>
                    <p class="text-base mt-4 lg:mt-8">Simplify digital payments, inspire trust, lead innovation and contribute to financial inclusion.</p>
                </div>
                <div class="backgroundBlur flex-1 p-6 rounded-xl">
                    <div class="flex items-start gap-4" data-aos="fade-up">
                        <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#FFFFFF"/>
                        </svg>
                        <h2 class="mt-2 text-2xl lg:text-4xl font-lora font-bold">Vision</h2>
                    </div>
                    <p class="text-base mt-4 lg:mt-8">To become a global digital financial services enabler.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="section-5" class="our-app py-16 md:py-32 text-center mx-auto">
        <div class="container">
            <div class="w-full md:w-3/5 mx-auto">
                <div class="flex justify-center items-center gap-1 text-sm text-[#C7D165] font-libre font-bold uppercase" data-aos="fade-up">
                    <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#C7D165"/>
                    </svg>
                    <h2>Our App</h2>
                </div>
                <h3 class="mt-6 text-2xl lg:text-5xl font-lora font-bold" data-aos="fade-up">Explore new ways to master your money</h3>
                <button class="mt-3 md:mt-6 py-2 px-8 text-sm font-medium text-white bg-[#09052B] hover:bg-[#585E8D] rounded-full transition-[background] duration-300 ease-in-out" data-aos="fade-up">Learn more</button>
            </div>
            <img class="mt-8" src="/images/our-app.webp" alt="Our app" width="2480" height="1052"/>
        </div>
    </section>

    <section id="section-6" class="board py-16 pb-32 bg-gradient-to-r from-[#09052B] to-[#585E8D]">
        <div class="container">
            <div class="flex items-center gap-1 text-sm text-[#C7D165] font-libre font-bold uppercase" data-aos="fade-up">
                <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#C7D165"/>
                </svg>
                <h2>Board Members</h2>
            </div>
            <h3 class="mt-6 text-2xl lg:text-5xl font-lora font-bold text-white" data-aos="fade-up">The faces behind Monty Finance</h3>

            <div class="flex flex-col gap-4 mt-12">
                <!-- Big Item -->
                <div v-for="(item, index) in board" :key="item.id" class="backgroundBlur flex max-md:flex-col gap-8 rounded-xl p-6">
                    <div class="lg:w-1/5 relative">
                        <img class="rounded-lg w-full" :src="item.image" :alt="item.name" />
                        <!-- <a href="" class="flex absolute bottom-4 right-4" target="_blank" aria-label="Linkedin" rel="noopener">
                            <img src="/images/linkedin.svg" alt="Linkedin" width="30" height="30" />
                        </a> -->
                    </div>
                    <div class="lg:w-4/5 flex flex-col">
                        <h5 class="text-base text-white uppercase font-bold">{{ item.role }}</h5>
                        <h4 class="text-xl font-lora text-[#DFDFE0] font-bold mt-1">{{ item.name }}</h4>
                        <p class="text-base text-[#DFDFE0] mt-4" v-html="item.description"></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="section-7" class="contact-us py-16 md:py-32">
        <div class="container">
            <div class="flex max-md:flex-col items-center gap-24">
                <div class="w-full lg:w-3/5">
                    <div class="flex items-center gap-1 text-sm text-[#C7D165] font-libre font-bold uppercase">
                        <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#C7D165"/>
                        </svg>
                        <h2>Contact Us</h2>
                    </div>
                    <h3 class="mt-6 text-2xl lg:text-5xl font-lora font-bold">Reach out to us today</h3>
                    <p class="flex items-center gap-2 mt-6 text-base text-[#73788B]">Our team is always ready to assist you or answer your inquiries.<br />Fill out this form to reach us.</p>

                    <div class="flex flex-col gap-6 lg:gap-12 mt-8">
                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.full_name" type="text" id="full_name" placeholder="Full Name" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.full_name" class="text-red-500 text-xs">{{ errors.full_name }}</div>
                            </div>
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.email" type="text" id="email" placeholder="Email" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.email" class="text-red-500 text-xs">{{ errors.email }}</div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.company_name" type="text" id="company_name" placeholder="Company Name" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.company_name" class="text-red-500 text-xs">{{ errors.company_name }}</div>
                            </div>
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.position" type="text" id="position" placeholder="Position/Profession" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.position" class="text-red-500 text-xs">{{ errors.position }}</div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <div class="flex flex-col gap-1 w-full">
                                <div class="flex flex-row gap-2">
                                    <div class="flex flex-col gap-1 w-[160px]">
                                        <div @click="toggleDropdown" class="custom-dropdown w-full text-sm px-4 py-2 text-black border-b border-b-[#D0D5DD] outline-none cursor-pointer">
                                            <div id="selected-country" class="flex justify-start items-center gap-2">
                                                <img class="selected-country--image" :src="`/images/flags/${selectedCountry.iso2 || 'LB' }.svg`" :alt="selectedCountry.name || 'Lebanon'" width="20" height="20">
                                                <span class="selected-country--name">+{{ selectedCountry.code || '961' }}</span>
                                            </div>
                                        </div>
                                        <input v-model="form.code" type="hidden" id="code">
                                        <div v-if="errors.code" class="text-red-500 text-xs">{{ errors.code }}</div>
                                    </div>

                                    <ul v-if="showDropdown" ref="dropdownContainer" @scroll="handleScroll" class="dropdown-container absolute top-full left-0 w-full max-h-[200px] text-sm rounded-xl bg-primary text-black mt-2 overflow-auto z-50">
                                        <input v-model="searchQuery" type="text" id="search" placeholder="Search" class="sticky top-0 left-0 w-full bg-primary px-4 py-2 border-b border-b-slate-200 outline-0 z-10">
                                        <template v-for="country in filteredCountries">
                                            <li v-if="country.status == 1" :key="country.id" @click="selectCountry(country)" class="flex gap-2 text-black p-2 hover:bg-slate-200 cursor-pointer">
                                                <img :src="`/images/flags/${country.iso2}.svg`" :alt="country.name" width="20" height="20" />
                                                <span class="text-xs text-[#73788B]">(+{{ country.code }})</span>
                                                <span class="text-xs">{{ country.name }}</span>
                                            </li>
                                        </template>
                                    </ul>

                                    <div class="flex flex-col gap-1 w-full">
                                        <input v-model="form.mobile" type="text" id="mobile" placeholder="Phone Number" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                        <div v-if="errors.mobile" class="text-red-500 text-xs">{{ errors.mobile }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.subject" type="text" id="subject" placeholder="Subject" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.subject" class="text-red-500 text-xs">{{ errors.subject }}</div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <div class="flex flex-col gap-1 w-full">
                                <textarea v-model="form.message" id="message" placeholder="Message" class="w-full text-sm px-4 py-2 text-black border-b border-b-[#D0D5DD] outline-none resize-none" rows="7"></textarea>
                                <div v-if="errors.message" class="text-red-500 text-xs">{{ errors.message }}</div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <button type="submit" id="submit" class="px-14 py-3 text-white text-center bg-[#585E8D] hover:bg-[#09052B] rounded-full transition-[background] duration-300 ease-in-out font-semibold" @click.prevent="handleSubmit">Send message</button>
                        </div>
                    </div>

                    <div v-if="submissionMessage" class="mt-4 text-xs" :class="{'text-red-500': isError, 'text-gray-500': !isError}">{{ submissionMessage }}</div>
                </div>
                <div class="w-full lg:w-2/5">
                    <div class="flex flex-col justify-center items-stretch gap-4 lg:gap-8">
                        <div class="flex-1 p-6 md:p-12 bg-gray-100 rounded">
                            <h2 class="mt-2 text-2xl text-[#585E8D] font-lora font-bold">Head Office Address</h2>
                            <p class="block mt-2 text-base text-[#73788B]">Gefinor Center, Clemenceau Street, Hamra, Beirut, Lebanon</p>
                        </div>
                        <div class="flex-1 p-6 md:p-12 bg-gray-100 rounded">
                            <h2 class="mt-2 text-2xl text-[#585E8D] font-lora font-bold">Customer Support</h2>
                            <a href="mailto:info@montyfinance.com" class="block mt-2 text-base text-[#73788B]">info@montyfinance.com</a>
                        </div>
                        <div class="flex flex-col lg:flex-row gap-4 lg:gap-8">
                            <div class="flex-1 p-6 md:p-12 bg-gray-100 rounded">
                                <h2 class="mt-2 text-2xl text-[#585E8D] font-lora font-bold">Call Center</h2>
                                <p class="block mt-2 text-base text-[#73788B]">+961 1 734 020</p>
                            </div>
                            <div class="flex-1 p-6 md:p-12 bg-gray-100 rounded">
                                <h2 class="mt-2 text-2xl text-[#585E8D] font-lora font-bold">WhatsApp</h2>
                                <a href="mailto:info@montyfinance.com" class="block mt-2 text-base text-[#73788B]">+961 71 871 871</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</template>

<script setup>
import { useCountry } from '~/composables/useCountry';

useSeoMeta({
    title: 'Homepage Lebanon',
    description: '',

    ogTitle: 'Homepage Lebanon',
    ogDescription: '',
    ogImage: '/assets/images/share-image-team.webp',

    twitterTitle: 'Homepage Lebanon',
    twitterDescription: '',
    twitterCard: 'summary_large_image',
})

    // Set the class on the <body> tag
    useHead({
        bodyAttrs: {
            class: 'homepage'
        }
    });

const { selectedCountry, detectCountry, countriesData } = useCountry();

const emit = defineEmits();

const route = useRoute();
const currentPath = route.path;
const currentRoute = computed(() => route.path);

// Country-related State
const countries = ref([]);
const showDropdown = ref(false);
const placeholder = 'Code';
const filteredCountries = ref([]);
const searchQuery = ref('');
const dropdownContainer = ref(null);
const lastLoadedIndex = ref(0);
const searchFlag = ref(false);
const initialCode = ref(''); // Store initial value

// Submission State
const submissionMessage = ref('');
const isSubmitting = ref(false);
const isError = ref(false);

const board = ref([
    {
        id: 1,
        image: '/images/mountasser-hachem1.webp',
        name: 'Mountasser Hachem',
        role: 'Chairman',
        linkedin: '#',
        description:'Mr. Hachem is a seasoned entrepreneur with over 25 years of experience, whose visionary leadership has been crucial in shaping the success of Monty Group, a global company with subsidiaries across telecom, fintech, hospitality, and aviation. Known for his strategic foresight and risk-taking, he has driven the company’s growth by seizing opportunities in emerging industries and adapting to market shifts. Under his leadership, Monty Group has rapidly expanded its international presence and established a reputation for excellence, creating a lasting legacy of success. With a diverse portfolio that includes Monty Mobile, Monty eSIM, Monty Finance, MyMonty Europe, Monty Capital, and others, Mr. Hachem has solidified Monty Group’s position as a dynamic, multi-industry enterprise at the forefront of innovation and global business.',
    },
    {
        id: 2,
        image: '/images/george-kanaan.webp',
        name: 'George Kanaan',
        role: 'Board Member',
        linkedin: '#',
        description: 'George is an independent non-executive Board Member at Monty Finance since February 2024. He is also the Honorary Chairman of the Arab Bankers Association in London, where he also served as CEO from 2009 to 2024. A banking and finance expert, George boasts a distinguished career with extensive leadership experience in major financial institutions, including Citibank in London, Greece and Saudi Arabia, and First National Bank of Chicago in London. George headed Saudi American Bank\'s (a Citibank subsidiary) London branch, which he created in 1987. He also started Samba Capital Management International (SCMI), a portfolio management operation, and led its business development. Under his leadership, SCMI grew to manage nearly $3 billion in assets. George has also served as CEO of Makshaff Services Limited, a family office which he created, managing over $3 billion in global assets with offices in Riyadh, Geneva, and London.',
    },
    {
        id: 3,
        image: '/images/walter-siouffi.webp',
        name: 'Walter Siouffi',
        role: 'Board Member',
        linkedin: '#',
        description: 'Walter joined the Monty Finance Board in February 2024 as an independent non-executive board Member. He also serves as an independent non-executive Chairman of the Board of Bank of Africa UK Plc. Previously, he was an independent Board Member and Chairman of the Audit Committee at Attijariwafa Bank Egypt. Walter enjoys an extensive career in banking with major international banks including the Royal Bank of Canada, American Express Bank and Citibank, where he held senior positions at the head office and field level in risk management, structured finance, treasury, country management and corporate banking, in Canada, Japan and the MENA region. In 2017 he joined the Millennium Challenge Corporation for three years as Resident Country Director and Attaché based at the U.S. Embassy in Rabat, overseeing the implementation of a $450 million grant to the Moroccan Government, aimed at unblocking constraints to economic growth.',
    },
    {
        id: 4,
        image: '/images/gaby-andari1.webp',
        name: 'Gaby Andari',
        role: 'Board Member',
        linkedin: '#',
        description: 'Gaby joined the Monty Finance Board in February 2024 as an independent non-executive Board Member. He is a transformative information technology expert with more than 25 years of experience in digital transformation and strategic IT leadership in the high-tech and financial services industries. In his previous role as Chief Information Officer at Bank of Beirut, he has spearheaded global IT and business digital transformation initiatives, overseeing a team of IT professionals across multiple regions including Lebanon, Australia, Oman, the UK, and Cyprus. Before this, he worked in IT leadership roles at fortune 500 and high-growth companies in the USA and Canada. Notably, he served as Vice President, Information Technology and Chief Information Officer at the Canadian Scholarship Trust Plan, and held key strategic roles at Boston Acoustics, Perseptive Biosystems, and Millipore.',
    },
]);

onMounted(async () => {
    // Load initial countries in the country code dropdown
    loadInitialCountries();

    // Detect country immediately on component mount and assign it to form.value.code
    detectCountry().then(() => {
        initialCode.value = selectedCountry.value.code
        form.value.code = selectedCountry.value.code;
    });
});

const form = ref({
    full_name: '',
    email: '',
    company_name: '',
    position: '',
    code: '',
    mobile: '',
    subject: '',
    message: '',
});

const errors = ref({
    full_name: '',
    email: '',
    company_name: '',
    position: '',
    code: '',
    mobile: '',
    subject: '',
    message: '',
});

const validationRules = {
    full_name: {
        required: 'Please enter your full name',
        safe: 'Your input has invalid value'
    },
    email: {
        required: 'Please enter your email address',
        email: 'Please enter a valid email address',
        safe: 'Your input has invalid value'
    },
    company_name: {
        required: 'Please enter your company name',
        safe: 'Your input has invalid value'
    },
    position: {
        required: 'Please enter your position/profession',
        safe: 'Your input has invalid value'
    },
    code: {
        required: 'Please choose your country code',
        code: 'Please enter a valid country code',
        safe: 'Your input has invalid value'
    },
    mobile: {
        required: 'Please enter your mobile number',
        numeric: 'Please enter a valid numeric phone number',
        length: 'Please enter a valid phone number',
        safe: 'Your input has invalid value'
    },
    subject: {
        required: 'Please enter your subject',
          safe: 'Your input has invalid value'
    },
    message: {
        required: 'Please enter your message',
        safe: 'Your input has invalid value'
    },
};

// Submitting the form
const handleSubmit = async () => {
    // Disable the submit button
    isSubmitting.value = true;

    // Validate form fields
    const isFormValid = validateForm(form, errors, validationRules);

    // If either form or file validation fails, stop submission
    if (!isFormValid) {
        // console.log('Validation failed:', errors.value);
        isSubmitting.value = false; // Re-enable the button
        submissionMessage.value = 'Please ensure all required fields are correctly filled and try submitting again.'; // Re-enable the butto
        isError.value = true;
        return; // Stop submission if form or file validation fails
    }

    try {
        const API_ENDPOINT = 'https://backend.montyfinance.com/wp-json/contact-form-7/v1/contact-forms/13/feedback';
        const formData = new FormData();

        // Append top-level fields

        Object.keys(form.value).forEach((key) => {
            formData.append(key, form.value[key]);
        });
        formData.append('_wpcf7_unit_tag', 'rte');

        const response = await fetch(API_ENDPOINT, {
            method: 'POST',
            body: formData,
            headers: {
                'Accept': 'application/json',
                // 'Content-Type': 'multipart/form-data' // No need to set this header for FormData
            },
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        
        const data = await response.json();
        // console.log("Form submitted successfully:", data);

        if(data.status == 'validation_failed'){
            submissionMessage.value = "Error in submitting your message. Please try again later";
            isError.value = true;

            // Clear error message after 2 seconds
            setTimeout(() => {
                submissionMessage.value = '';
            }, 2000);
            throw new Error('Validation Error');
        }

        submissionMessage.value = "Thank you for your message."
        isError.value = false;
        // Clear success message after 2 seconds
        setTimeout(() => {
            submissionMessage.value = '';
        }, 2000);

        resetForm();
        //Handle success response, such as notifying the user or redirecting
    } catch (error) {
        // console.error("Form submission error:", error);
        // Set error message
        submissionMessage.value = "Error in submitting your message. Please try again later";
        isError.value = true;

        // Clear error message after 2 seconds
        setTimeout(() => {
            submissionMessage.value = '';
        }, 2000);
    } finally {
        // Re-enable the submit button
        isSubmitting.value = false;
    }
};

// Resetting the form
const resetForm = () => {
    form.value = {
        email: '',
        company_name: '',
        position: '',
code: selectedCountry.value ? selectedCountry.value.code : initialCode.value,
        code: '',
        mobile: '',
        subject: '',
        message: '',
    };
    errors.value = {
        full_name: '',
        email: '',
        company_name: '',
        position: '',
        code: '',
        mobile: '',
        subject: '',
        message: '',
    };
};

// Choosing Country
const toggleDropdown = () => {
    showDropdown.value = !showDropdown.value;

    // Reset country list and lastLoadedIndex when closing the dropdown
    if (!showDropdown.value) {
        resetDropdown();
    }
};

const resetDropdown = () => {
    countries.value = [];
    lastLoadedIndex.value = 0;
    filteredCountries.value = [];
    searchFlag.value = false
    searchQuery.value = ''
    loadInitialCountries();
};

const closeDropdown = () => {
    loadInitialCountries();
};

const selectCountry = (country) => {
    selectedCountry.value = country;
    form.value.code = country.code;
    emit('select', country);
    showDropdown.value = false;
    resetDropdown()
};

const loadInitialCountries = () => {
    loadNextCountries();
};

const loadNextCountries = () => {
    const batchSize = 10;
    const startIndex = lastLoadedIndex.value;
    const endIndex = startIndex + batchSize;
    const nextBatch = countriesData.slice(startIndex, endIndex);

    countries.value = [...countries.value, ...nextBatch];
    lastLoadedIndex.value = endIndex;
    filteredCountries.value = countries.value;
};

const handleScroll = () => {
    const container = dropdownContainer.value;
    if (searchQuery.value === '' && container.scrollTop + container.clientHeight >= container.scrollHeight - 20) {
        if (!searchFlag.value) {
            loadNextCountries();
        }
    }
};

const searchCountries = () => {
    const searchResults = countriesData.filter((country) =>
        country.name.toLowerCase().includes(searchQuery.value.toLowerCase())
    );
    if (searchQuery.value != '') {
        filteredCountries.value = searchResults;
        searchFlag.value = true
    }
    else {
        resetDropdown();
    }
};

watch(searchQuery, searchCountries);
</script>

<style lang="sass" scoped>
    .marquee .wrapper:hover
        animation-play-state: paused

    .dropdown-container 
        box-shadow: 0 0.1875rem 0.5rem #00000022

    .readMore:hover svg path
        @apply stroke-[#09052B]
</style>