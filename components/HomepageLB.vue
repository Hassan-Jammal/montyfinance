<template>
    <section id="section-1" class="flex flex-col justify-center items-center h-screen bg-[url('public/images/banner-lb.png')] bg-no-repeat bg-cover bg-center">
        <div class="container">
            <div class="flex flex-col justify-center gap-4 w-full md:w-1/2 xl:w-1/3 h-full">
                <h1 class="text-[#09052B] text-2xl lg:text-[3rem] font-lora !leading-[1.3] text-[#09052B] font-bold" data-aos="fade-up" data-aos-delay="100"><span class="block text-[#73788B] font-medium">Empowering Every Lebanese</span>with Inclusive Access to Essential Financial Services</h1>
                <div>
                    <ScrollButton target="contact-us" class="mt-3 md:mt-6 py-2 px-8 text-sm font-medium text-white bg-[#09052B] rounded-full transition-[background] duration-300 ease-in-out" data-aos="fade-up" data-aos-delay="300">Contact us</ScrollButton>
                </div>
            </div>
        </div>
    </section>

    <section id="section-2" class="about-us py-16 md:py-32 text-center mx-auto">
        <div class="container">
            <div class="w-full md:w-3/5 mx-auto">
                <div class="flex justify-center items-center gap-1 text-sm text-[#C7D165] font-libre font-bold uppercase" data-aos="fade-up">
                    <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#C7D165"/>
                    </svg>
                    <h2>About Monty Finance</h2>
                </div>
                <h3 class="mt-6 text-2xl lg:text-5xl font-lora" data-aos="fade-up">Unlocking your financial freedom with confidence</h3>
                <p class="mt-6 text-xl text-[#09052B] font-lora" data-aos="fade-up">Welcome to Monty Finance SAL, where innovation meets integrity, 
                    and financial inclusion is our driving force.</p>
                <p class="mt-6 text-base text-[#73788B]" data-aos="fade-up">As a proud member of the esteemed Monty Telecommunications Group, boasting a legacy of over 25 years and a global presence across 20+ countries, we stand as a beacon of progress and empowerment in the fintech landscape. In 2021, amidst the convergence of telecommunications and fintech, Monty Group started a strategic journey, establishing our fintech division with headquarters in the vibrant hubs of Dubai DIFC, Switzerland, and the UK.<br /><br />This pivotal expansion marked the inception of our pioneering neo-banking platform, aimed at democratizing access to financial services for the unbanked and digitally savvy individuals across Europe and the UK.</p>
            </div>
            <div class="flex justify-center items-center gap-6 mt-10 text-[#585E8D]">
                <div class="w-full p-4 sm:p-14 bg-gray-100">
                    <span class="block text-3xl sm:text-7xl font-lora">25</span>
                    <span class="block text-base">Years of experience</span>
                </div>
                <div class="w-full p-4 sm:p-14 bg-gray-100">
                    <span class="block text-3xl sm:text-7xl font-lora">20+</span>
                    <span class="block text-base">Countries worldwide</span>
                </div>
            </div>
        </div>
    </section>

    <section id="section-3" class="pt-28 pb-28 md:pt-32 bg-[#F8F6F8]">
        <div class="container">
            <div class="w-full md:w-4/5 mx-auto flex max-md:flex-col justify-center items-center gap-7 md:gap-14">
                <img class="rounded-xl" src="/images/mountasser-hachem.webp" alt="Mountasser Hachem" width="480" height="611"/>

                <div class="flex flex-col gap-4">
                    <img src="/images/quote.svg" alt="Quote box" width="74" height="73"/>
                    <p class="mt-6 text-xl text-[#09052B] font-lora" data-aos="fade-up">In light of the financial challenges Lebanon was facing, we at Monty Finance SAL are committed to a bold vision.</p>
                    <p class="mt-6 text-base text-[#73788B]" data-aos="fade-up">Ensuring that every Lebanese citizen has unfettered access to essential financial services.<br />
                    Guided by the visionary leadership of <span class="text-[#09052B]">Mr. Mountasser El Hachem</span>, Chairman of Monty Group, we have taken decisive steps to achieve this vision. With the strategic acquisition of a financial institution in Lebanon and the acquisition of an e-wallet license from the central bank, we are poised to make a meaningful impact on the financial landscape of Lebanon.</p>
                </div>
            </div>

            <div class="w-full md:w-4/5 mx-auto flex max-md:flex-col justify-center items-center gap-7 md:gap-24 mt-24">
                <img src="/images/f.svg" alt="F" width="144" height="192"/>

                <div class="flex flex-col gap-4">
                    <p class="mt-6 text-xl text-[#09052B] font-lora" data-aos="fade-up">At Monty Finance SAL, we firmly believe that access to financial services is a fundamental right.</p>
                    <p class="mt-6 text-base text-[#73788B]" data-aos="fade-up">At Monty Finance SAL, we firmly believe that access to financial services is a fundamental right. Drawing upon decades of international experience and the collective expertise of our team, comprised of industry veterans from leading financial and consulting firms, we are dedicated to developing tailored financial solutions that address the unique needs and challenges of the Lebanese community.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="section-4" class="py-16 md:py-32 text-white">
        <div class="container">
            <div class="px-8 md:px-16 py-16 md:py-32 bg-[url('public/images/mission-vision-lb.png')] bg-no-repeat bg-cover bg-top flex max-md:flex-col justify-center items-stretch gap-14 md:gap-28 rounded-xl">
                <div class="backgroundBlur flex-1 p-6 rounded-xl">
                    <div class="flex items-start gap-4" data-aos="fade-up">
                        <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#FFFFFF"/>
                        </svg>
                        <h2 class="mt-2 text-2xl lg:text-5xl font-lora">Mission</h2>
                    </div>
                    <p class="mt-8">Simplify digital payments, inspire trust, lead innovation and contribute to financial inclusion.</p>
                </div>
                <div class="backgroundBlur flex-1 p-6 rounded-xl">
                    <div class="flex items-start gap-4" data-aos="fade-up">
                        <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#FFFFFF"/>
                        </svg>
                        <h2 class="mt-2 text-2xl lg:text-5xl font-lora">Vision</h2>
                    </div>
                    <p class="mt-8">To become a global digital financial services enabler.</p>
                </div>
            </div>
        </div>
    </section>
    
    <section id="section-5" class="portfolio py-16 md:py-32 text-center mx-auto">
        <div class="container">
            <div class="w-full md:w-3/5 mx-auto">
                <div class="flex justify-center items-center gap-1 text-sm text-[#C7D165] font-libre font-bold uppercase" data-aos="fade-up">
                    <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#C7D165"/>
                    </svg>
                    <h2>Affiliated With</h2>
                </div>
                <h3 class="mt-6 text-2xl lg:text-5xl font-lora" data-aos="fade-up">Explore new ways to master your money</h3>
                <button class="mt-3 md:mt-6 py-2 px-8 text-sm font-medium text-white bg-[#09052B] rounded-full transition-[background] duration-300 ease-in-out" data-aos="fade-up">Learn more</button>
            </div>
            <img class="mt-8" src="/images/affiliated-with.png" alt="Affiliated With" width="2496" height="1077"/>
        </div>
    </section>

    <section id="section-6" class="board py-16 pb-32 bg-gradient-to-r from-[#09052B] to-[#585E8D]">
        <div class="container">
            <div class="flex items-center gap-1 text-sm text-white font-libre font-bold uppercase" data-aos="fade-up">
                <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#C7D165"/>
                </svg>
                <h2>Affiliated With</h2>
            </div>
            <h3 class="mt-6 text-2xl lg:text-5xl font-lora text-white" data-aos="fade-up">The faces behind Monty Finance</h3>

            <div class="flex flex-col gap-8">
                <!-- Big Item -->
                <div class="backgroundBlur grid grid-cols-1 md:grid-cols-3 items-center gap-8 rounded-xl p-6 mt-8">
                    <div class="w-full relative">
                        <img class="max-md:w-full rounded-lg w-full" :src="selectedItem.image" :alt="selectedItem.name" />
                        <a href="" class="flex absolute bottom-4 right-4" target="_blank" aria-label="Linkedin" rel="noopener">
                            <img src="/images/linkedin.svg" alt="Linkedin" width="30" height="30" />
                        </a>
                    </div>
                    <div class="md:col-span-2 flex flex-col">
                        <h5 class="text-base text-white uppercase font-bold">{{ selectedItem.role }}</h5>
                        <h4 class="text-xl font-lora text-[#DFDFE0] font-bold mt-1">{{ selectedItem.name }}</h4>
                        <p class="sm:text-base xl:text-lg text-[#DFDFE0] mt-4" v-html="selectedItem.description"></p>
                    </div>
                </div>

                <!-- Grid Items -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div v-for="(item, index) in otherItems" :key="item.id" class="backgroundBlur grid grid-cols-2 gap-4 rounded-xl p-6 cursor-pointer">
                        <div class="relative">
                            <img class="w-full h-full object-cover rounded-lg" :src="item.image" :alt="item.name" />
                            <a href="" class="flex absolute bottom-4 right-4" target="_blank" aria-label="Linkedin" rel="noopener">
                                <img src="/images/linkedin.svg" alt="Linkedin" width="25" height="25" />
                            </a>
                        </div>
                        <div class="flex flex-col justify-between py-6">
                            <div>
                                <h5 class="text-sm text-white uppercase font-bold">{{ item.role }}</h5>
                                <h4 class="text-lg font-lora text-[#DFDFE0] font-bold mt-1">{{ item.name }}</h4>
                            </div>
                            <ScrollButton target="board" class="readMore flex items-center gap-2 text-base text-[#DFDFE0] cursor-pointer" @click="swapItems(index)">
                                <p>Read More</p>
                                <img src="/images/arrow-up-right.svg" alt="Arrow Up Right" width="25" height="25" />
                            </ScrollButton>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="section-7" class="contact-us py-16 md:py-32">
        <div class="container">
            <div class="flex max-md:flex-col items-center gap-8">
                <div class="flex-1 w-full">
                    <div class="flex items-center gap-1 text-sm text-[#C7D165] font-libre font-bold uppercase" data-aos="fade-up">
                        <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#C7D165"/>
                        </svg>
                        <h2>Contact Us</h2>
                    </div>
                    <h3 class="mt-6 text-2xl lg:text-5xl font-lora" data-aos="fade-up">Reach out to us today</h3>
                    <p class="flex items-center gap-2 mt-6 text-base text-[#73788B]" data-aos="fade-up">Our team is always ready to assist you or answer your inquiries.<br />Fill out this form to reach us.</p>

                    <div class="flex flex-col gap-6 mt-8">
                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.full_name" type="text" id="full_name" placeholder="Full Name" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.full_name" class="text-red-500 text-xs">{{ errors.full_name }}</div>
                            </div>
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.email" type="text" id="email" placeholder="Email" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.email" class="text-red-500 text-xs">{{ errors.email }}</div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.company_name" type="text" id="company_name" placeholder="Company Name" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.company_name" class="text-red-500 text-xs">{{ errors.company_name }}</div>
                            </div>
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.position" type="text" id="position" placeholder="Position/Profession" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.position" class="text-red-500 text-xs">{{ errors.position }}</div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <div class="flex flex-col gap-1 w-full">
                                <div class="flex flex-row gap-2">
                                    <div class="flex flex-col gap-1 w-[160px]">
                                        <div @click="toggleDropdown" class="custom-dropdown w-full text-sm px-4 py-2 text-black border-b border-b-[#D0D5DD] outline-none cursor-pointer">
                                            <div id="selected-country" class="flex justify-start items-center gap-2">
                                                <img class="selected-country--image" :src="`/images/flags/${selectedCountry.iso2 || 'LB' }.svg`" :alt="selectedCountry.name || 'Lebanon'" width="20" height="20">
                                                <span class="selected-country--name">+{{ selectedCountry.code || '961' }}</span>
                                            </div>
                                        </div>
                                        <input v-model="form.code" type="hidden" id="code">
                                        <div v-if="errors.code" class="text-red-500 text-xs">{{ errors.code }}</div>
                                    </div>

                                    <ul v-if="showDropdown" ref="dropdownContainer" @scroll="handleScroll" class="dropdown-container absolute top-full left-0 w-full max-h-[200px] text-sm rounded-xl bg-primary text-black mt-2 overflow-auto z-50">
                                        <input v-model="searchQuery" type="text" id="search" placeholder="Search" class="sticky top-0 left-0 w-full bg-primary px-4 py-2 border-b border-b-slate-200 outline-0 z-10">
                                        <template v-for="country in filteredCountries">
                                            <li v-if="country.status == 1" :key="country.id" @click="selectCountry(country)" class="flex gap-2 text-black p-2 hover:bg-slate-200 cursor-pointer">
                                                <img :src="`/images/flags/${country.iso2}.svg`" :alt="country.name" width="20" height="20" />
                                                <span class="text-xs text-[#73788B]">(+{{ country.code }})</span>
                                                <span class="text-xs">{{ country.name }}</span>
                                            </li>
                                        </template>
                                    </ul>

                                    <div class="flex flex-col gap-1 w-full">
                                        <input v-model="form.mobile" type="text" id="mobile" placeholder="Phone Number" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                        <div v-if="errors.mobile" class="text-red-500 text-xs">{{ errors.mobile }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col gap-1 w-full">
                                <input v-model="form.subject" type="text" id="subject" placeholder="Subject" class="w-full text-sm px-3 py-2 text-black border-b border-b-[#D0D5DD] outline-none">
                                <div v-if="errors.subject" class="text-red-500 text-xs">{{ errors.subject }}</div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6 w-full">
                            <div class="flex flex-col gap-1 w-full">
                                <textarea v-model="form.message" id="message" placeholder="Message" class="w-full text-sm px-4 py-2 text-black border-b border-b-[#D0D5DD] outline-none resize-none" rows="7"></textarea>
                                <div v-if="errors.message" class="text-red-500 text-xs">{{ errors.message }}</div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col md:flex-row gap-6 w-full" data-aos="fade-up">
                            <button type="submit" id="submit" class="px-14 py-3 text-white text-center bg-[#585E8D] hover:bg-[#09052B] rounded-full transition-[background] duration-300 ease-in-out" @click.prevent="handleSubmit">Send message</button>
                        </div>
                    </div>

                    <div v-if="submissionMessage" class="mt-4 text-xs" :class="{'text-red-500': isError, 'text-gray-500': !isError}">{{ submissionMessage }}</div>
                </div>
                <div class="flex-1 w-full">
                    <div class="flex flex-col justify-center items-stretch gap-8">
                        <div class="flex-1 p-6 md:p-12 bg-gray-100">
                            <div class="flex items-start gap-4" data-aos="fade-up">
                                <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#585E8D"/>
                                </svg>
                                <img class="mt-3" src="/images/marker-pin.svg" alt="Maker Pin" width="30" height="30" />
                                <div>
                                    <h2 class="mt-2 text-3xl text-[#585E8D] font-lora">Office Address</h2>
                                    <p class="block mt-2 text-[#73788B]">Gefinor Center, Hamra, Beirut, Lebanon</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 p-6 md:p-12 bg-gray-100">
                            <div class="flex items-start gap-4" data-aos="fade-up">
                                <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#585E8D"/>
                                </svg>
                                <img class="mt-3" src="/images/mail.svg" alt="Mail" width="30" height="30" />
                                <div>
                                    <h2 class="mt-2 text-3xl text-[#585E8D] font-lora">General Inquiries</h2>
                                    <a href="mailto:montyfinance@gmail.com" class="block mt-2 text-[#73788B]">montyfinance@gmail.com</a>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 p-6 md:p-12 bg-gray-100">
                            <div class="flex items-start gap-4" data-aos="fade-up">
                                <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 0.5H4.89919H0V5.41129V12.5" fill="#585E8D"/>
                                </svg>
                                <img class="mt-3" src="/images/phone.svg" alt="Phone" width="30" height="30" />
                                <div>
                                    <h2 class="mt-2 text-3xl text-[#585E8D] font-lora">Toll-Free Number</h2>
                                    <a href="tel:+448082387522" class="block mt-2 text-[#73788B]">+44 808 238 7522</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</template>

<script setup>
	import { useCountry } from '~/composables/useCountry';

	useSeoMeta({
        title: 'Homepage Lebanon',
        description: '',

        ogTitle: 'Homepage Lebanon',
        ogDescription: '',
        ogImage: '/assets/images/share-image-team.webp',

        twitterTitle: 'Homepage Lebanon',
        twitterDescription: '',
        twitterCard: 'summary_large_image',
    })

	const { selectedCountry, detectCountry, countriesData } = useCountry();

	const emit = defineEmits();

	const route = useRoute();
	const currentPath = route.path;
    const currentRoute = computed(() => route.path);

	// Country-related State
    const countries = ref([]);
    const showDropdown = ref(false);
    const placeholder = 'Code';
    const filteredCountries = ref([]);
    const searchQuery = ref('');
    const dropdownContainer = ref(null);
    const lastLoadedIndex = ref(0);
    const searchFlag = ref(false);
    const initialCode = ref(''); // Store initial value

    // Submission State
    const submissionMessage = ref('');
    const isSubmitting = ref(false);
    const isError = ref(false);

    const allItems = ref([
        {
            id: 1,
            image: '/images/mountasser-hachem1.png',
            name: 'Mountasser Hachem',
            role: 'Chairman',
            linkedin: '#',
            description:'With more than 20 years leading a group of holdings, Mr. Hachem is always striving to make a difference in the lives of others even if it means taking risks and venturing into new fields.<br />Ambitious, bold and driven, he founded Monty Group and its subsidiaries and dove into the telecom world over two decades ago, building a successful career and transforming the company into an international hub with several branches all over the world.',
        },
        {
            id: 2,
            image: '/images/george-kanaan.png',
            name: 'George Kanaan',
            role: 'Board Member',
            linkedin: '#',
            description: 'George is an independent non-executive Board Member at Monty Finance since February 2024. He is also the Honorary Chairman of the Arab Bankers Association in London, where he also served as CEO from 2009 to 2024. A banking and finance expert, George boasts a distinguished career with extensive leadership experience in major financial institutions, including Citibank in London, Greece and Saudi Arabia, and First National Bank of Chicago in London. George headed Saudi American Bank\'s (a Citibank subsidiary) London branch, which he created in 1987. He also started Samba Capital Management International (SCMI), a portfolio management operation, and led its business development. Under his leadership, SCMI grew to manage nearly $3 billion in assets. George has also served as CEO of Makshaff Services Limited, a family office which he created, managing over $3 billion in global assets with offices in Riyadh, Geneva, and London.',
        },
        {
            id: 3,
            image: '/images/walter-siouffi.png',
            name: 'Walter Siouffi',
            role: 'Board Member',
            linkedin: '#',
            description: 'Walter joined the Monty Finance Board in February 2024 as an independent non-executive board Member. He also serves as an independent non-executive Chairman of the Board of Bank of Africa UK Plc. Previously, he was an independent Board Member and Chairman of the Audit Committee at Attijariwafa Bank Egypt. Walter enjoys an extensive career in banking with major international banks including the Royal Bank of Canada, American Express Bank and Citibank, where he held senior positions at the head office and field level in risk management, structured finance, treasury, country management and corporate banking, in Canada, Japan and the MENA region. In 2017 he joined the Millennium Challenge Corporation for three years as Resident Country Director and AttachÃ© based at the U.S. Embassy in Rabat, overseeing the implementation of a $450 million grant to the Moroccan Government, aimed at unblocking constraints to economic growth.',
        },
        {
            id: 4,
            image: '/images/gaby-andari1.png',
            name: 'Gaby Andari',
            role: 'Board Member',
            linkedin: '#',
            description: 'Gaby joined the Monty Finance Board in February 2024 as an independent non-executive Board Member. He is a transformative information technology expert with more than 25 years of experience in digital transformation and strategic IT leadership in the high-tech and financial services industries. In his previous role as Chief Information Officer at Bank of Beirut, he has spearheaded global IT and business digital transformation initiatives, overseeing a team of IT professionals across multiple regions including Lebanon, Australia, Oman, the UK, and Cyprus. Before this, he worked in IT leadership roles at fortune 500 and high-growth companies in the USA and Canada. Notably, he served as Vice President, Information Technology and Chief Information Officer at the Canadian Scholarship Trust Plan, and held key strategic roles at Boston Acoustics, Perseptive Biosystems, and Millipore.',
        },
    ]);

    const selectedItem = ref(allItems.value[0]);
    const otherItems = ref(allItems.value.slice(1));

    const swapItems = (index) => {
        const clickedItem = otherItems.value[index];
        const currentBigItem = selectedItem.value;

        // Swap
        selectedItem.value = clickedItem;
        otherItems.value.splice(index, 1, currentBigItem);
    };

	onMounted(async () => {
		// Load initial countries in the country code dropdown
        loadInitialCountries();

		// Detect country immediately on component mount and assign it to form.value.code
		detectCountry().then(() => {
			initialCode.value = selectedCountry.value.code
			form.value.code = selectedCountry.value.code;
		});
    });

	const form = ref({
        full_name: '',
        email: '',
        company_name: '',
        position: '',
		code: '',
        mobile: '',
        subject: '',
        message: '',
    });

    const errors = ref({
        full_name: '',
        email: '',
        company_name: '',
        position: '',
		code: '',
        mobile: '',
        subject: '',
        message: '',
    });

    const validationRules = {
        full_name: {
            required: 'Please enter your full name',
            safe: 'Your input has invalid value'
        },
        email: {
            required: 'Please enter your email address',
            email: 'Please enter a valid email address',
            safe: 'Your input has invalid value'
        },
        company_name: {
            required: 'Please enter your company name',
            safe: 'Your input has invalid value'
        },
		position: {
            required: 'Please enter your position/profession',
            safe: 'Your input has invalid value'
        },
        code: {
            required: 'Please choose your country code',
            code: 'Please enter a valid country code',
            safe: 'Your input has invalid value'
        },
        mobile: {
            required: 'Please enter your mobile number',
            numeric: 'Please enter a valid numeric phone number',
            length: 'Please enter a valid phone number',
            safe: 'Your input has invalid value'
        },
        subject: {
            required: 'Please enter your subject',
            safe: 'Your input has invalid value'
        },
        message: {
            required: 'Please enter your message',
            safe: 'Your input has invalid value'
        },
    };

	// Submitting the form
	const handleSubmit = async () => {
        // Disable the submit button
        isSubmitting.value = true;

        // Validate form fields
        const isFormValid = validateForm(form, errors, validationRules);

        // If either form or file validation fails, stop submission
        if (!isFormValid) {
            // console.log('Validation failed:', errors.value);
            isSubmitting.value = false; // Re-enable the button
            submissionMessage.value = 'Please ensure all required fields are correctly filled and try submitting again.'; // Re-enable the butto
            isError.value = true;
            return; // Stop submission if form or file validation fails
        }

        try {
            const API_ENDPOINT = 'https://backend.montyfinance.com/wp-json/contact-form-7/v1/contact-forms/13/feedback';
            const formData = new FormData();

            // Append top-level fields

            Object.keys(form.value).forEach((key) => {
				formData.append(key, form.value[key]);
            });
            formData.append('_wpcf7_unit_tag', 'rte');

            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json',
                    // 'Content-Type': 'multipart/form-data' // No need to set this header for FormData
                },
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            
            const data = await response.json();
            // console.log("Form submitted successfully:", data);

            if(data.status == 'validation_failed'){
                submissionMessage.value = "Error in submitting your message. Please try again later";
                isError.value = true;

                // Clear error message after 2 seconds
                setTimeout(() => {
                    submissionMessage.value = '';
                }, 2000);
                throw new Error('Validation Error');
            }

            submissionMessage.value = "Thank you for your message."
            isError.value = false;
            // Clear success message after 2 seconds
            setTimeout(() => {
                submissionMessage.value = '';
            }, 2000);

            resetForm();
            //Handle success response, such as notifying the user or redirecting
        } catch (error) {
            // console.error("Form submission error:", error);
            // Set error message
            submissionMessage.value = "Error in submitting your message. Please try again later";
            isError.value = true;

            // Clear error message after 2 seconds
            setTimeout(() => {
                submissionMessage.value = '';
            }, 2000);
        } finally {
            // Re-enable the submit button
            isSubmitting.value = false;
        }
    };

	// Resetting the form
    const resetForm = () => {
        form.value = {
            email: '',
            company_name: '',
            position: '',
			code: selectedCountry.value ? selectedCountry.value.code : initialCode.value,
            code: '',
            mobile: '',
            subject: '',
            message: '',
        };
        errors.value = {
            full_name: '',
            email: '',
            company_name: '',
            position: '',
            code: '',
            mobile: '',
            subject: '',
            message: '',
        };
    };

	// Choosing Country
    const toggleDropdown = () => {
        showDropdown.value = !showDropdown.value;

        // Reset country list and lastLoadedIndex when closing the dropdown
        if (!showDropdown.value) {
            resetDropdown();
        }
    };

    const resetDropdown = () => {
        countries.value = [];
        lastLoadedIndex.value = 0;
        filteredCountries.value = [];
        searchFlag.value = false
        searchQuery.value = ''
        loadInitialCountries();
    };

    const closeDropdown = () => {
        loadInitialCountries();
    };

    const selectCountry = (country) => {
        selectedCountry.value = country;
        form.value.code = country.code;
        emit('select', country);
        showDropdown.value = false;
        resetDropdown()
    };

    const loadInitialCountries = () => {
        loadNextCountries();
    };

    const loadNextCountries = () => {
        const batchSize = 10;
        const startIndex = lastLoadedIndex.value;
        const endIndex = startIndex + batchSize;
        const nextBatch = countriesData.slice(startIndex, endIndex);

        countries.value = [...countries.value, ...nextBatch];
        lastLoadedIndex.value = endIndex;
        filteredCountries.value = countries.value;
    };

    const handleScroll = () => {
        const container = dropdownContainer.value;
        if (searchQuery.value === '' && container.scrollTop + container.clientHeight >= container.scrollHeight - 20) {
            if (!searchFlag.value) {
                loadNextCountries();
            }
        }
    };

    const searchCountries = () => {
        const searchResults = countriesData.filter((country) =>
            country.name.toLowerCase().includes(searchQuery.value.toLowerCase())
        );
        if (searchQuery.value != '') {
            filteredCountries.value = searchResults;
            searchFlag.value = true
        }
        else {
            resetDropdown();
        }
    };

    watch(searchQuery, searchCountries);
</script>

<style lang="sass" scoped>
	.marquee .wrapper:hover
		animation-play-state: paused

	.dropdown-container 
		box-shadow: 0 0.1875rem 0.5rem #00000022

</style>